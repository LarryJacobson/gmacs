<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>GMACS: tpl FUNCTIONS</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">GMACS
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Length structured assessment model for crustaceans</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>SECTION</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dc/d0a/group___p_r_o_c_e_d_u_r_e___s_e_c_t_i_o_n.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">tpl FUNCTIONS</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gab6ce8eaf8d318c1d10155888cd1bb8dc"><td class="memItemLeft" align="right" valign="top">model_parameters::dvar_vector&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d0a/group___p_r_o_c_e_d_u_r_e___s_e_c_t_i_o_n.html#gab6ce8eaf8d318c1d10155888cd1bb8dc">calc_growth_increments</a> (const dvector vSizes, const <a class="el" href="../../de/d39/classivector.html">ivector</a> iSex)</td></tr>
<tr class="memdesc:gab6ce8eaf8d318c1d10155888cd1bb8dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute growth increments.  <a href="#gab6ce8eaf8d318c1d10155888cd1bb8dc">More...</a><br /></td></tr>
<tr class="separator:gab6ce8eaf8d318c1d10155888cd1bb8dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga759ae15dca5395d6ce5856d020cae7ea"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d0a/group___p_r_o_c_e_d_u_r_e___s_e_c_t_i_o_n.html#ga759ae15dca5395d6ce5856d020cae7ea">initialize_model_parameters</a> ()</td></tr>
<tr class="memdesc:ga759ae15dca5395d6ce5856d020cae7ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize model parameters.  <a href="#ga759ae15dca5395d6ce5856d020cae7ea">More...</a><br /></td></tr>
<tr class="separator:ga759ae15dca5395d6ce5856d020cae7ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga506b567a6d89c4da54d4e3eac9c383ee"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d0a/group___p_r_o_c_e_d_u_r_e___s_e_c_t_i_o_n.html#ga506b567a6d89c4da54d4e3eac9c383ee">calc_selectivities</a> ()</td></tr>
<tr class="memdesc:ga506b567a6d89c4da54d4e3eac9c383ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate selectivies for each gear.  <a href="#ga506b567a6d89c4da54d4e3eac9c383ee">More...</a><br /></td></tr>
<tr class="separator:ga506b567a6d89c4da54d4e3eac9c383ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0395ca8c64d5e7b7505b202d2ccf8692"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d0a/group___p_r_o_c_e_d_u_r_e___s_e_c_t_i_o_n.html#ga0395ca8c64d5e7b7505b202d2ccf8692">calc_fishing_mortality</a> ()</td></tr>
<tr class="memdesc:ga0395ca8c64d5e7b7505b202d2ccf8692"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate fishing mortality rates for each fleet.  <a href="#ga0395ca8c64d5e7b7505b202d2ccf8692">More...</a><br /></td></tr>
<tr class="separator:ga0395ca8c64d5e7b7505b202d2ccf8692"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga414796bfb07b183050fe17e3f166d093"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d0a/group___p_r_o_c_e_d_u_r_e___s_e_c_t_i_o_n.html#ga414796bfb07b183050fe17e3f166d093">calc_growth_transition</a> ()</td></tr>
<tr class="memdesc:ga414796bfb07b183050fe17e3f166d093"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calclate the size transtion matrix.  Team.  <a href="#ga414796bfb07b183050fe17e3f166d093">More...</a><br /></td></tr>
<tr class="separator:ga414796bfb07b183050fe17e3f166d093"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa136d309ee87fe0a74f31a2e1cdfc7aa"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d0a/group___p_r_o_c_e_d_u_r_e___s_e_c_t_i_o_n.html#gaa136d309ee87fe0a74f31a2e1cdfc7aa">calc_natural_mortality</a> ()</td></tr>
<tr class="memdesc:gaa136d309ee87fe0a74f31a2e1cdfc7aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate natural mortality array.  <a href="#gaa136d309ee87fe0a74f31a2e1cdfc7aa">More...</a><br /></td></tr>
<tr class="separator:gaa136d309ee87fe0a74f31a2e1cdfc7aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga699ce07387ba579607ad90aee0411750"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d0a/group___p_r_o_c_e_d_u_r_e___s_e_c_t_i_o_n.html#ga699ce07387ba579607ad90aee0411750">calc_total_mortality</a> ()</td></tr>
<tr class="memdesc:ga699ce07387ba579607ad90aee0411750"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate total instantaneous mortality rate and survival rate.  <a href="#ga699ce07387ba579607ad90aee0411750">More...</a><br /></td></tr>
<tr class="separator:ga699ce07387ba579607ad90aee0411750"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8075fc2531bf313d671d2d51ca64833f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d0a/group___p_r_o_c_e_d_u_r_e___s_e_c_t_i_o_n.html#ga8075fc2531bf313d671d2d51ca64833f">calc_molting_probability</a> ()</td></tr>
<tr class="memdesc:ga8075fc2531bf313d671d2d51ca64833f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the probability of moulting vs carapace width.  <a href="#ga8075fc2531bf313d671d2d51ca64833f">More...</a><br /></td></tr>
<tr class="separator:ga8075fc2531bf313d671d2d51ca64833f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa8e6923fd2a6cd7a75bce69974e8226b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d0a/group___p_r_o_c_e_d_u_r_e___s_e_c_t_i_o_n.html#gaa8e6923fd2a6cd7a75bce69974e8226b">calc_recruitment_size_distribution</a> ()</td></tr>
<tr class="memdesc:gaa8e6923fd2a6cd7a75bce69974e8226b"><td class="mdescLeft">&#160;</td><td class="mdescRight">calculate size distribution for new recuits.  <a href="#gaa8e6923fd2a6cd7a75bce69974e8226b">More...</a><br /></td></tr>
<tr class="separator:gaa8e6923fd2a6cd7a75bce69974e8226b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4d22c9f7d15dc3ee186aefff26bb98d6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d0a/group___p_r_o_c_e_d_u_r_e___s_e_c_t_i_o_n.html#ga4d22c9f7d15dc3ee186aefff26bb98d6">calc_initial_numbers_at_length</a> ()</td></tr>
<tr class="memdesc:ga4d22c9f7d15dc3ee186aefff26bb98d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">initialiaze populations numbers-at-length in syr  <a href="#ga4d22c9f7d15dc3ee186aefff26bb98d6">More...</a><br /></td></tr>
<tr class="separator:ga4d22c9f7d15dc3ee186aefff26bb98d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga946ab60c4cc9aafe91f8b8c085d0408c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d0a/group___p_r_o_c_e_d_u_r_e___s_e_c_t_i_o_n.html#ga946ab60c4cc9aafe91f8b8c085d0408c">update_population_numbers_at_length</a> ()</td></tr>
<tr class="memdesc:ga946ab60c4cc9aafe91f8b8c085d0408c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update numbers-at-length.  <a href="#ga946ab60c4cc9aafe91f8b8c085d0408c">More...</a><br /></td></tr>
<tr class="separator:ga946ab60c4cc9aafe91f8b8c085d0408c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac94ce4c196772344c58f6950dabcc53b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d0a/group___p_r_o_c_e_d_u_r_e___s_e_c_t_i_o_n.html#gac94ce4c196772344c58f6950dabcc53b">calc_stock_recruitment_relationship</a> ()</td></tr>
<tr class="memdesc:gac94ce4c196772344c58f6950dabcc53b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate stock recruitment relationship.  <a href="#gac94ce4c196772344c58f6950dabcc53b">More...</a><br /></td></tr>
<tr class="separator:gac94ce4c196772344c58f6950dabcc53b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga06378cd144e85f2a8712054a4d565212"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d0a/group___p_r_o_c_e_d_u_r_e___s_e_c_t_i_o_n.html#ga06378cd144e85f2a8712054a4d565212">calc_predicted_catch</a> ()</td></tr>
<tr class="memdesc:ga06378cd144e85f2a8712054a4d565212"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate predicted catch observations.  <a href="#ga06378cd144e85f2a8712054a4d565212">More...</a><br /></td></tr>
<tr class="separator:ga06378cd144e85f2a8712054a4d565212"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5005f7b1705ea5b416e78f1eb18ce59f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d0a/group___p_r_o_c_e_d_u_r_e___s_e_c_t_i_o_n.html#ga5005f7b1705ea5b416e78f1eb18ce59f">calc_relative_abundance</a> ()</td></tr>
<tr class="memdesc:ga5005f7b1705ea5b416e78f1eb18ce59f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate predicted relative abundance and residuals.  <a href="#ga5005f7b1705ea5b416e78f1eb18ce59f">More...</a><br /></td></tr>
<tr class="separator:ga5005f7b1705ea5b416e78f1eb18ce59f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga971c7f8d3994d7a2b5ceb4ec7396a2cb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d0a/group___p_r_o_c_e_d_u_r_e___s_e_c_t_i_o_n.html#ga971c7f8d3994d7a2b5ceb4ec7396a2cb">calc_predicted_composition</a> ()</td></tr>
<tr class="memdesc:ga971c7f8d3994d7a2b5ceb4ec7396a2cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate predicted size composition data.  <a href="#ga971c7f8d3994d7a2b5ceb4ec7396a2cb">More...</a><br /></td></tr>
<tr class="separator:ga971c7f8d3994d7a2b5ceb4ec7396a2cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga827c5b05b0d787e9f5bee4be2cc5ad6d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d0a/group___p_r_o_c_e_d_u_r_e___s_e_c_t_i_o_n.html#ga827c5b05b0d787e9f5bee4be2cc5ad6d">calculate_prior_densities</a> ()</td></tr>
<tr class="memdesc:ga827c5b05b0d787e9f5bee4be2cc5ad6d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate prior density functions for leading parameters.  <a href="#ga827c5b05b0d787e9f5bee4be2cc5ad6d">More...</a><br /></td></tr>
<tr class="separator:ga827c5b05b0d787e9f5bee4be2cc5ad6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7856107600b59f7ca91f6be8c9fa5751"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d0a/group___p_r_o_c_e_d_u_r_e___s_e_c_t_i_o_n.html#ga7856107600b59f7ca91f6be8c9fa5751">calc_objective_function</a> ()</td></tr>
<tr class="memdesc:ga7856107600b59f7ca91f6be8c9fa5751"><td class="mdescLeft">&#160;</td><td class="mdescRight">calculate objective function  <a href="#ga7856107600b59f7ca91f6be8c9fa5751">More...</a><br /></td></tr>
<tr class="separator:ga7856107600b59f7ca91f6be8c9fa5751"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>FUNCTIONS declared in the tpl PROCEDURE_SECTION. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga0395ca8c64d5e7b7505b202d2ccf8692"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void model_parameters::calc_fishing_mortality </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate fishing mortality rates for each fleet. </p>
<p>For each fleet estimate scaler log_fbar and deviates (f_devs). </p><pre class="fragment"> In the event that there is effort data and catch data, then it's possible
 to estimate a catchability coefficient and predict the catch for the
 period of missing catch/discard data.  Best option for this would be
 to use F = q*E, where q = F/E.  Then in the objective function, minimize
 the variance in the estimates of q, and use the mean q to predict catch.
 Or minimize the first difference and assume a random walk in q.

 Note that this function calculates the fishing mortality rate including
 deaths due to discards.  Where lambda is the discard mortality rate.

 Note also that Jie estimates F for retained fishery, f for male discards and
 f for female discards.  Not recommended to have separate F' for retained and 
 discard fisheries, but might be ok to have sex-specific F's.  

 TODO 
 -[ ] fix discard mortality rate.</pre> 
<p>Definition at line <a class="el" href="../../dd/da9/gmacs_8tpl_source.html#l01357">1357</a> of file <a class="el" href="../../dd/da9/gmacs_8tpl_source.html">gmacs.tpl</a>.</p>

</div>
</div>
<a class="anchor" id="gab6ce8eaf8d318c1d10155888cd1bb8dc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">dvar_vector model_parameters::calc_growth_increments </td>
          <td>(</td>
          <td class="paramtype">const dvector&#160;</td>
          <td class="paramname"><em>vSizes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../de/d39/classivector.html">ivector</a>&#160;</td>
          <td class="paramname"><em>iSex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Compute growth increments. </p>
<p>Presently based on liner form </p><pre class="fragment"> @param vSizes is a vector of size data from which to compute predicted values
 @param iSex   is an integer vector indexing sex (1 = male, 2 = female )
 @return dvar_vector of predicted growth increments</pre><p>Presently based on liner form</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">vSizes</td><td>is a vector of size data from which to compute predicted values </td></tr>
    <tr><td class="paramname">iSex</td><td>is an integer vector indexing sex (1 = male, 2 = female ) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>dvar_vector of predicted growth increments </dd></dl>
<p>Molt increment as a linear function of pre-molt size.</p>
<p>TODO Option for empirical molt increments.</p>

<p>Definition at line <a class="el" href="../../dd/da9/gmacs_8tpl_source.html#l01423">1423</a> of file <a class="el" href="../../dd/da9/gmacs_8tpl_source.html">gmacs.tpl</a>.</p>

</div>
</div>
<a class="anchor" id="ga414796bfb07b183050fe17e3f166d093"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void model_parameters::calc_growth_transition </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calclate the size transtion matrix.  Team. </p>
<p>Calculates the size transition matrix for each sex based on growth increments, which is a linear function of the size interval, and the scale parameter for the gamma distribution. This function does the proper integration from the lower to upper size bin, where the mode of the growth increment is scaled by the scale parameter.</p>
<p>This function loops over sex, then loops over the rows of the size transition matrix for each sex. The probability of transitioning from size l to size ll is based on the vector molt_increment and the scale parameter. In all there are three parameters that define the size transition matrix (alpha, beta, scale) for each sex.</p>
<p>Issue 112 details some of evolution of code development here </p>
<p>Calculate natural mortality array</p>
<p>Natural mortality (M) is a 3d array for sex, year and size. </p><dl class="section return"><dt>Returns</dt><dd>NULL</dd></dl>
<p>todo:</p><ul>
<li>Add time varying components</li>
<li>Size-dependent mortality</li>
</ul>

<p>Definition at line <a class="el" href="../../dd/da9/gmacs_8tpl_source.html#l01491">1491</a> of file <a class="el" href="../../dd/da9/gmacs_8tpl_source.html">gmacs.tpl</a>.</p>

</div>
</div>
<a class="anchor" id="ga4d22c9f7d15dc3ee186aefff26bb98d6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void model_parameters::calc_initial_numbers_at_length </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>initialiaze populations numbers-at-length in syr </p>
<dl class="section author"><dt>Author</dt><dd>Steve Martell</dd></dl>
<p>This function initializes the populations numbers-at-length in the initial year of the model.</p>
<p>Psuedocode: See note from Dave Fournier.</p>
<p>For the initial numbers-at-lengt a vector of deviates is estimated, one for each size class, and have the option to initialize the model at unfished equilibrium, or some other steady state condition.</p>
<p>Dec 11, 2014. Martell &amp; Ianelli at snowgoose. We had a discussion regarding how to deal with the joint probability of molting and growing to a new size interval for a given length, and the probability of not molting. We settled on using the size-tranistion matrix to represent this joint probability, where the diagonal of the matrix to represent the probability of surviving and molting to a new size interval. The upper diagonal of the size-transition matrix represent the probability of growing to size interval j' given size interval j.</p>
<p>Oldshell crabs are then the column vector of 1-molt_probabiltiy times the numbers-at-length, and the Newshell crabs is the column vector of molt_probability times the number-at-length.</p>
<p>Jan 1, 2015. Changed how the equilibrium calculation is done. Use a numerical approach to solve the newshell oldshell initial abundance.</p>
<p>–––-—————————————————————————————————————————————————————————————————————————-&mdash; Jan 3, 2015. Working with John Levitt on analytical solution instead of the numerical approach. Think we have a soln.</p>
<p>Notation: n = vector of newshell crabs o = vector of oldshell crabs P = diagonal matrix of molting probabilities by size S = diagonal matrix of survival rates by size A = Size transition matrix. r = vector of new recruits (newshell) I = identity matrix.</p>
<p>The following equations represent the dynamics of newshell and oldshell crabs. n = nSPA + oSPA + r (1) o = oS(I-P)A + nS(I-P)A (2) Objective is to solve the above equations for n and o repsectively. Starting with o: o = n(I-P)S[I-(I-P)S]^(-1) (3) next substitute (3) into (1) and solve for n n = nPSA + n(I-P)S[I-(I-P)S]^(-1)PSA + r</p>
<p>let B = [I-(I-P)S]^(-1) </p><pre class="fragment">n - nPSA - n(I-P)SBPSA = r
n(I - PSA - (I-P)SBPSA) = r
</pre><p>let C = (I - PSA - (I-P)SBPSA)</p>
<p>then n = C^(-1) r (4) –––-—————————————————————————————————————————————————————————————————————————-&mdash; –––-—————————————————————————————————————————————————————————————————————————-&mdash;</p>
<p>April 28, 2015. There is no case here for initializing the model at unfished equilibrium conditions. Need to fix this for SRA purposes. SJDM. </p>
<p>Update numbers-at-length </p><dl class="section author"><dt>Author</dt><dd>Steve Martell</dd></dl>
<p>Numbers at length are propagated each year for each sex based on the size transition matrix and a vector of size-specifc survival rates. The columns of the size-transition matrix are multiplied by the size-specific survival rate (a sclaer). New recruits are added based on the estimated aveerage recruitment and annual deviate, multiplied by a vector of size-proportions (rec_sdd).</p>

<p>Definition at line <a class="el" href="../../dd/da9/gmacs_8tpl_source.html#l01764">1764</a> of file <a class="el" href="../../dd/da9/gmacs_8tpl_source.html">gmacs.tpl</a>.</p>

</div>
</div>
<a class="anchor" id="ga8075fc2531bf313d671d2d51ca64833f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void model_parameters::calc_molting_probability </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate the probability of moulting vs carapace width. </p>
<p>Note that the parameters molt_mu and molt cv can only be estimated in cases where there is new shell and old shell data.</p>
<p>Note that the diagonal of the P matrix != 0, otherwise the matrix is singular in inv(P). </p>
<p>calculate size distribution for new recuits.</p>
<p>Based on the gamma distribution, calculates the probability of a new recruit being in size-interval size.</p>
<p>TODO: fix the scale on cumd_gamma distribution so beta rbeta is estimable.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ra</td><td>is the mean of the distribution. </td></tr>
    <tr><td class="paramname">rbeta</td><td>scales the variance of the distribution</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../dd/da9/gmacs_8tpl_source.html#l01651">1651</a> of file <a class="el" href="../../dd/da9/gmacs_8tpl_source.html">gmacs.tpl</a>.</p>

</div>
</div>
<a class="anchor" id="gaa136d309ee87fe0a74f31a2e1cdfc7aa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void model_parameters::calc_natural_mortality </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate natural mortality array. </p>
<p>Natural mortality (M) is a 3d array for sex, year and size. </p><dl class="section return"><dt>Returns</dt><dd>NULL</dd></dl>
<p>todo:</p><ul>
<li>Add time varying components</li>
<li>Size-dependent mortality </li>
</ul>
<p>Calculate total instantaneous mortality rate and survival rate</p>
<p>\( S = exp(-Z) \) </p><dl class="section return"><dt>Returns</dt><dd>NULL</dd></dl>
<p>ISSUE, for some reason the diagonal of S goes to NAN if linear growth model is used. Due to F.</p>

<p>Definition at line <a class="el" href="../../dd/da9/gmacs_8tpl_source.html#l01541">1541</a> of file <a class="el" href="../../dd/da9/gmacs_8tpl_source.html">gmacs.tpl</a>.</p>

</div>
</div>
<a class="anchor" id="ga7856107600b59f7ca91f6be8c9fa5751"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void model_parameters::calc_objective_function </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>calculate objective function </p>
<p>Likelihood components</p><ol type="1">
<li>likelihood of the catch data (assume lognormal error)</li>
<li>likelihood of relative abundance data</li>
<li>likelihood of size composition data</li>
</ol>
<p>Penalty components</p><ol type="1">
<li>Penalty on log_fdev to ensure they sum to zero.</li>
<li>Penalty to regularize values of log_fbar.</li>
<li>Penalty to constrain random walk in natural mortaliy rates </li>
</ol>
<p>Simulation model</p>
<p>Uses many of the same routines as the assessment model, over-writes the observed data in memory with simulated data.</p>

<p>Definition at line <a class="el" href="../../dd/da9/gmacs_8tpl_source.html#l02559">2559</a> of file <a class="el" href="../../dd/da9/gmacs_8tpl_source.html">gmacs.tpl</a>.</p>

</div>
</div>
<a class="anchor" id="ga06378cd144e85f2a8712054a4d565212"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void model_parameters::calc_predicted_catch </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate predicted catch observations. </p>
<p>The function uses the Baranov catch equation to predict the retained and discarded catch.</p>
<p>Assumptions: 1) retained (landed catch) is assume to be newshell male only. 2) discards are all females (new and old) and male only crab. 3) Natural and fishing mortality occur simultaneously. 4) discard is the total number of crab caught and discarded.</p>
<pre class="fragment"> @param  [description]
 @return NULL</pre> <p>Calculate predicted relative abundance and residuals </p><dl class="section author"><dt>Author</dt><dd>Steve Martell</dd></dl>
<p>This function uses the conditional mle for q to scale the population to the relative abundance index. Assumed errors in relative abundance are lognormal. Currently assumes that the CPUE index is made up of both retained and discarded crabs.</p>
<p>Question regarding use of shell condition in the relative abundance index. Currenlty there is no shell condition information in the CPUE data, should there be? Similarly, there is no mature immature information, should there be?</p>

<p>Definition at line <a class="el" href="../../dd/da9/gmacs_8tpl_source.html#l02047">2047</a> of file <a class="el" href="../../dd/da9/gmacs_8tpl_source.html">gmacs.tpl</a>.</p>

</div>
</div>
<a class="anchor" id="ga971c7f8d3994d7a2b5ceb4ec7396a2cb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void model_parameters::calc_predicted_composition </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate predicted size composition data. </p>
<p>Predicted size composition data are given in proportions. Size composition strata:</p><ul>
<li>sex (0 = both sexes, 1 = male, 2 = female)</li>
<li>type (0 = all catch, 1 = retained, 2 = discard)</li>
<li>shell condition (0 = all, 1 = new shell, 2 = oldshell)</li>
<li>mature or immature (0 = both, 1 = immature, 2 = mature)</li>
</ul>
<p>NB Sitting in a campground on the Orgeon Coast writing this code, with baby Tabitha sleeping on my back.</p>
<p>TODO:</p><ul>
<li>add pointers for shell type. DONE</li>
<li>add pointers for maturity state. DONE</li>
<li>need pointer for retained vs. discarded.</li>
</ul>
<p>Jan 5, 2015. Size compostion data can come in a number of forms. Given sex, maturity and 3 shell conditions, there are 12 possible combinations for adding up the numbers at length (nal). Shell Sex Maturity condition Description </p><hr/>
<p> Male 0 1 immature, new shell ! Male 0 2 immature, old shell ! Male 0 0 immature, new &amp; old shell 1 Male, immature, new shell Male 1 1 mature, new shell Male 1 2 mature, old shell Male 1 0 mature, new &amp; old shell Female 0 1 immature, new shell !Female 0 2 immature, old shell !Female 0 0 immature, new &amp; old shell Female 1 1 mature, new shell Female 1 2 mature, old shell Female 1 0 mature, new &amp; old shell </p><hr/>
<p>Call function to get the appropriate numbers-at-length.</p>
<p>TODO: [x] Check to ensure new shell old shell is working. [ ] Add maturity component for data sets with mature old and mature new. [ ] Issue 53, comps/total(sex,shell cond) [ ] </p>

<p>Definition at line <a class="el" href="../../dd/da9/gmacs_8tpl_source.html#l02299">2299</a> of file <a class="el" href="../../dd/da9/gmacs_8tpl_source.html">gmacs.tpl</a>.</p>

</div>
</div>
<a class="anchor" id="gaa8e6923fd2a6cd7a75bce69974e8226b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void model_parameters::calc_recruitment_size_distribution </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>calculate size distribution for new recuits. </p>
<p>Based on the gamma distribution, calculates the probability of a new recruit being in size-interval size.</p>
<p>TODO: fix the scale on cumd_gamma distribution so beta rbeta is estimable.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ra</td><td>is the mean of the distribution. </td></tr>
    <tr><td class="paramname">rbeta</td><td>scales the variance of the distribution </td></tr>
  </table>
  </dd>
</dl>
<p>initialiaze populations numbers-at-length in syr </p><dl class="section author"><dt>Author</dt><dd>Steve Martell</dd></dl>
<p>This function initializes the populations numbers-at-length in the initial year of the model.</p>
<p>Psuedocode: See note from Dave Fournier.</p>
<p>For the initial numbers-at-lengt a vector of deviates is estimated, one for each size class, and have the option to initialize the model at unfished equilibrium, or some other steady state condition.</p>
<p>Dec 11, 2014. Martell &amp; Ianelli at snowgoose. We had a discussion regarding how to deal with the joint probability of molting and growing to a new size interval for a given length, and the probability of not molting. We settled on using the size-tranistion matrix to represent this joint probability, where the diagonal of the matrix to represent the probability of surviving and molting to a new size interval. The upper diagonal of the size-transition matrix represent the probability of growing to size interval j' given size interval j.</p>
<p>Oldshell crabs are then the column vector of 1-molt_probabiltiy times the numbers-at-length, and the Newshell crabs is the column vector of molt_probability times the number-at-length.</p>
<p>Jan 1, 2015. Changed how the equilibrium calculation is done. Use a numerical approach to solve the newshell oldshell initial abundance.</p>
<p>–––-—————————————————————————————————————————————————————————————————————————-&mdash; Jan 3, 2015. Working with John Levitt on analytical solution instead of the numerical approach. Think we have a soln.</p>
<p>Notation: n = vector of newshell crabs o = vector of oldshell crabs P = diagonal matrix of molting probabilities by size S = diagonal matrix of survival rates by size A = Size transition matrix. r = vector of new recruits (newshell) I = identity matrix.</p>
<p>The following equations represent the dynamics of newshell and oldshell crabs. n = nSPA + oSPA + r (1) o = oS(I-P)A + nS(I-P)A (2) Objective is to solve the above equations for n and o repsectively. Starting with o: o = n(I-P)S[I-(I-P)S]^(-1) (3) next substitute (3) into (1) and solve for n n = nPSA + n(I-P)S[I-(I-P)S]^(-1)PSA + r</p>
<p>let B = [I-(I-P)S]^(-1) </p><pre class="fragment">n - nPSA - n(I-P)SBPSA = r
n(I - PSA - (I-P)SBPSA) = r
</pre><p>let C = (I - PSA - (I-P)SBPSA)</p>
<p>then n = C^(-1) r (4) –––-—————————————————————————————————————————————————————————————————————————-&mdash; –––-—————————————————————————————————————————————————————————————————————————-&mdash;</p>
<p>April 28, 2015. There is no case here for initializing the model at unfished equilibrium conditions. Need to fix this for SRA purposes. SJDM.</p>

<p>Definition at line <a class="el" href="../../dd/da9/gmacs_8tpl_source.html#l01683">1683</a> of file <a class="el" href="../../dd/da9/gmacs_8tpl_source.html">gmacs.tpl</a>.</p>

</div>
</div>
<a class="anchor" id="ga5005f7b1705ea5b416e78f1eb18ce59f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void model_parameters::calc_relative_abundance </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate predicted relative abundance and residuals. </p>
<dl class="section author"><dt>Author</dt><dd>Steve Martell</dd></dl>
<p>This function uses the conditional mle for q to scale the population to the relative abundance index. Assumed errors in relative abundance are lognormal. Currently assumes that the CPUE index is made up of both retained and discarded crabs.</p>
<p>Question regarding use of shell condition in the relative abundance index. Currenlty there is no shell condition information in the CPUE data, should there be? Similarly, there is no mature immature information, should there be? </p>
<p>Calculate predicted size composition data.</p>
<p>Predicted size composition data are given in proportions. Size composition strata:</p><ul>
<li>sex (0 = both sexes, 1 = male, 2 = female)</li>
<li>type (0 = all catch, 1 = retained, 2 = discard)</li>
<li>shell condition (0 = all, 1 = new shell, 2 = oldshell)</li>
<li>mature or immature (0 = both, 1 = immature, 2 = mature)</li>
</ul>
<p>NB Sitting in a campground on the Orgeon Coast writing this code, with baby Tabitha sleeping on my back.</p>
<p>TODO:</p><ul>
<li>add pointers for shell type. DONE</li>
<li>add pointers for maturity state. DONE</li>
<li>need pointer for retained vs. discarded.</li>
</ul>
<p>Jan 5, 2015. Size compostion data can come in a number of forms. Given sex, maturity and 3 shell conditions, there are 12 possible combinations for adding up the numbers at length (nal). Shell Sex Maturity condition Description </p><hr/>
<p> Male 0 1 immature, new shell ! Male 0 2 immature, old shell ! Male 0 0 immature, new &amp; old shell 1 Male, immature, new shell Male 1 1 mature, new shell Male 1 2 mature, old shell Male 1 0 mature, new &amp; old shell Female 0 1 immature, new shell !Female 0 2 immature, old shell !Female 0 0 immature, new &amp; old shell Female 1 1 mature, new shell Female 1 2 mature, old shell Female 1 0 mature, new &amp; old shell </p><hr/>
<p>Call function to get the appropriate numbers-at-length.</p>
<p>TODO: [x] Check to ensure new shell old shell is working. [ ] Add maturity component for data sets with mature old and mature new. [ ] Issue 53, comps/total(sex,shell cond) [ ]</p>

<p>Definition at line <a class="el" href="../../dd/da9/gmacs_8tpl_source.html#l02181">2181</a> of file <a class="el" href="../../dd/da9/gmacs_8tpl_source.html">gmacs.tpl</a>.</p>

</div>
</div>
<a class="anchor" id="ga506b567a6d89c4da54d4e3eac9c383ee"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void model_parameters::calc_selectivities </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate selectivies for each gear. </p>
<dl class="section author"><dt>Author</dt><dd>Steve Martell</dd></dl>
<p>Three selectivities must be accounted for by each fleet. 1) capture probability, 2) retention probability, and 3) release probability.</p>
<p>Maintain the possibility of estimating selectivity independently for each sex; assumes there are data to estimate female selex.</p>
<p>BUG: There should be no retention of female crabs in the directed fishery.</p>
<p>Psuedocode:</p><ol type="1">
<li>Loop over each gear:</li>
<li>Create a pointer array with length = number of blocks</li>
<li>Based on slx_type, fill pointer with parameter estimates.</li>
<li><p class="startli">Loop over years and block-in the log_selectivity at mid points.</p>
<p class="startli">Need to deprecate the abstract class for selectivity, 7X slower. </p>
</li>
</ol>
<p>Calculate fishing mortality rates for each fleet.</p>
<p>For each fleet estimate scaler log_fbar and deviates (f_devs).</p>
<p>In the event that there is effort data and catch data, then it's possible to estimate a catchability coefficient and predict the catch for the period of missing catch/discard data. Best option for this would be to use F = q*E, where q = F/E. Then in the objective function, minimize the variance in the estimates of q, and use the mean q to predict catch. Or minimize the first difference and assume a random walk in q.</p>
<p>Note that this function calculates the fishing mortality rate including deaths due to discards. Where lambda is the discard mortality rate.</p>
<p>Note also that Jie estimates F for retained fishery, f for male discards and f for female discards. Not recommended to have separate F' for retained and discard fisheries, but might be ok to have sex-specific F's.</p>
<p>TODO -[ ] fix discard mortality rate.</p>

<p>Definition at line <a class="el" href="../../dd/da9/gmacs_8tpl_source.html#l01265">1265</a> of file <a class="el" href="../../dd/da9/gmacs_8tpl_source.html">gmacs.tpl</a>.</p>

</div>
</div>
<a class="anchor" id="gac94ce4c196772344c58f6950dabcc53b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void model_parameters::calc_stock_recruitment_relationship </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate stock recruitment relationship. </p>
<p>Assuming a Beverton-Holt relationship between the mature biomass (user defined) and the annual recruits. Note that we derive so and bb in R = so * MB / (1 + bb * Mb) from Ro and steepness (leading parameters defined in theta).</p>
<p>NOTES: if nSRR_flag == 1 then use a Beverton-Holt model to compute the recruitment deviations for minumization. </p>
<p>Calculate predicted catch observations</p>
<p>The function uses the Baranov catch equation to predict the retained and discarded catch.</p>
<p>Assumptions: 1) retained (landed catch) is assume to be newshell male only. 2) discards are all females (new and old) and male only crab. 3) Natural and fishing mortality occur simultaneously. 4) discard is the total number of crab caught and discarded.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">[description]</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NULL</dd></dl>

<p>Definition at line <a class="el" href="../../dd/da9/gmacs_8tpl_source.html#l01942">1942</a> of file <a class="el" href="../../dd/da9/gmacs_8tpl_source.html">gmacs.tpl</a>.</p>

</div>
</div>
<a class="anchor" id="ga699ce07387ba579607ad90aee0411750"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void model_parameters::calc_total_mortality </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate total instantaneous mortality rate and survival rate. </p>
<p>\( S = exp(-Z) \) </p><dl class="section return"><dt>Returns</dt><dd>NULL</dd></dl>
<p>ISSUE, for some reason the diagonal of S goes to NAN if linear growth model is used. Due to F. </p>
<p>Calculate the probability of moulting vs carapace width.</p>
<p>Note that the parameters molt_mu and molt cv can only be estimated in cases where there is new shell and old shell data.</p>
<p>Note that the diagonal of the P matrix != 0, otherwise the matrix is singular in inv(P).</p>

<p>Definition at line <a class="el" href="../../dd/da9/gmacs_8tpl_source.html#l01617">1617</a> of file <a class="el" href="../../dd/da9/gmacs_8tpl_source.html">gmacs.tpl</a>.</p>

</div>
</div>
<a class="anchor" id="ga827c5b05b0d787e9f5bee4be2cc5ad6d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void model_parameters::calculate_prior_densities </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate prior density functions for leading parameters. </p>
<ul>
<li>case 0 is a uniform density between the lower and upper bounds.</li>
<li>case 1 is a normal density with mean = p1 and sd = p2</li>
<li>case 2 is a lognormal density with mean = log(p1) and sd = p2</li>
<li>case 3 is a beta density bounded between lb-ub with p1 and p2 as alpha &amp; beta</li>
<li>case 4 is a gamma density with parameters p1 and p2.</li>
</ul>
<p>TODO Make this a generic function. Agrs would be vector of parameters, and matrix of controls </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">theta</td><td>a vector of parameters </td></tr>
    <tr><td class="paramname">C</td><td>matrix of controls (priorType, p1, p2, lb, ub) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>vector of prior densities for each parameter </dd></dl>
<p>calculate objective function</p>
<p>Likelihood components</p><ol type="1">
<li>likelihood of the catch data (assume lognormal error)</li>
<li>likelihood of relative abundance data</li>
<li>likelihood of size composition data</li>
</ol>
<p>Penalty components</p><ol type="1">
<li>Penalty on log_fdev to ensure they sum to zero.</li>
<li>Penalty to regularize values of log_fbar.</li>
<li>Penalty to constrain random walk in natural mortaliy rates</li>
</ol>

<p>Definition at line <a class="el" href="../../dd/da9/gmacs_8tpl_source.html#l02468">2468</a> of file <a class="el" href="../../dd/da9/gmacs_8tpl_source.html">gmacs.tpl</a>.</p>

</div>
</div>
<a class="anchor" id="ga759ae15dca5395d6ce5856d020cae7ea"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void model_parameters::initialize_model_parameters </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize model parameters. </p>
<p>Set global variable equal to the estimated parameter vectors. </p><pre class="fragment"> SM:  Note if using empirical growth increment data, then alpha and beta
 Growth parameters should not be estimated.  Need to warn the user
 if the following condition is true:
 if( bUseEmpiricalGrowth &amp;&amp; ( acitve(alpha) || active(beta) ) )</pre> <p>Calculate selectivies for each gear. </p><dl class="section author"><dt>Author</dt><dd>Steve Martell</dd></dl>
<p>Three selectivities must be accounted for by each fleet. 1) capture probability, 2) retention probability, and 3) release probability.</p>
<p>Maintain the possibility of estimating selectivity independently for each sex; assumes there are data to estimate female selex.</p>
<p>BUG: There should be no retention of female crabs in the directed fishery.</p>
<p>Psuedocode:</p><ol type="1">
<li>Loop over each gear:</li>
<li>Create a pointer array with length = number of blocks</li>
<li>Based on slx_type, fill pointer with parameter estimates.</li>
<li><p class="startli">Loop over years and block-in the log_selectivity at mid points.</p>
<p class="startli">Need to deprecate the abstract class for selectivity, 7X slower.</p>
<p class="startli">APRIL 28, 15, Finally fixed DF_dflog error</p>
</li>
</ol>

<p>Definition at line <a class="el" href="../../dd/da9/gmacs_8tpl_source.html#l01201">1201</a> of file <a class="el" href="../../dd/da9/gmacs_8tpl_source.html">gmacs.tpl</a>.</p>

</div>
</div>
<a class="anchor" id="ga946ab60c4cc9aafe91f8b8c085d0408c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void model_parameters::update_population_numbers_at_length </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update numbers-at-length. </p>
<dl class="section author"><dt>Author</dt><dd>Team</dd></dl>
<p>Numbers at length are propagated each year for each sex based on the size transition matrix and a vector of size-specifc survival rates. The columns of the size-transition matrix are multiplied by the size-specific survival rate (a sclaer). New recruits are added based on the estimated aveerage recruitment and annual deviate, multiplied by a vector of size-proportions (rec_sdd). </p>
<p>Calculate stock recruitment relationship.</p>
<p>Assuming a Beverton-Holt relationship between the mature biomass (user defined) and the annual recruits. Note that we derive so and bb in R = so * MB / (1 + bb * Mb) from Ro and steepness (leading parameters defined in theta).</p>
<p>NOTES: if nSRR_flag == 1 then use a Beverton-Holt model to compute the recruitment deviations for minumization.</p>

<p>Definition at line <a class="el" href="../../dd/da9/gmacs_8tpl_source.html#l01852">1852</a> of file <a class="el" href="../../dd/da9/gmacs_8tpl_source.html">gmacs.tpl</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Jun 25 2015 00:10:32 for GMACS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
